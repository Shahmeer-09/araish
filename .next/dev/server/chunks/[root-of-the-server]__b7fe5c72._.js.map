{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/downloads/project/jewelry-showcase/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///E:/downloads/project/jewelry-showcase/lib/auth.ts"],"sourcesContent":["import { cookies } from 'next/headers';\r\nimport bcrypt from 'bcryptjs';\r\nimport prisma from './prisma';\r\n\r\nconst SESSION_COOKIE_NAME = 'admin_session';\r\nconst SESSION_SECRET = process.env.SESSION_SECRET || 'your-secret-key-change-in-production';\r\n\r\nexport async function hashPassword(password: string): Promise<string> {\r\n  return bcrypt.hash(password, 12);\r\n}\r\n\r\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\r\n  return bcrypt.compare(password, hashedPassword);\r\n}\r\n\r\nexport async function createSession(username: string): Promise<string> {\r\n  const sessionToken = Buffer.from(`${username}:${Date.now()}:${SESSION_SECRET}`).toString('base64');\r\n  return sessionToken;\r\n}\r\n\r\nexport async function validateSession(): Promise<boolean> {\r\n  const cookieStore = await cookies();\r\n  const session = cookieStore.get(SESSION_COOKIE_NAME);\r\n  \r\n  if (!session?.value) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const decoded = Buffer.from(session.value, 'base64').toString('utf-8');\r\n    const [username] = decoded.split(':');\r\n    \r\n    const admin = await prisma.admin.findUnique({\r\n      where: { username },\r\n    });\r\n\r\n    return !!admin;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function login(username: string, password: string): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const admin = await prisma.admin.findUnique({\r\n      where: { username },\r\n    });\r\n\r\n    if (!admin) {\r\n      return { success: false, error: 'Invalid credentials' };\r\n    }\r\n\r\n    const isValid = await verifyPassword(password, admin.password);\r\n\r\n    if (!isValid) {\r\n      return { success: false, error: 'Invalid credentials' };\r\n    }\r\n\r\n    const sessionToken = await createSession(username);\r\n    const cookieStore = await cookies();\r\n    \r\n    cookieStore.set(SESSION_COOKIE_NAME, sessionToken, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 60 * 60 * 24, // 24 hours\r\n      path: '/',\r\n    });\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Login error:', error);\r\n    return { success: false, error: 'An error occurred during login' };\r\n  }\r\n}\r\n\r\nexport async function logout(): Promise<void> {\r\n  const cookieStore = await cookies();\r\n  cookieStore.delete(SESSION_COOKIE_NAME);\r\n}\r\n\r\nexport async function createAdminIfNotExists(): Promise<void> {\r\n  const adminUsername = process.env.ADMIN_USERNAME || 'admin';\r\n  const adminPassword = process.env.ADMIN_PASSWORD || 'admin123';\r\n\r\n  const existingAdmin = await prisma.admin.findUnique({\r\n    where: { username: adminUsername },\r\n  });\r\n\r\n  if (!existingAdmin) {\r\n    const hashedPassword = await hashPassword(adminPassword);\r\n    await prisma.admin.create({\r\n      data: {\r\n        username: adminUsername,\r\n        password: hashedPassword,\r\n      },\r\n    });\r\n    console.log('Admin user created');\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,sBAAsB;AAC5B,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI;AAE9C,eAAe,aAAa,QAAgB;IACjD,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe,cAAc,QAAgB;IAClD,MAAM,eAAe,OAAO,IAAI,CAAC,GAAG,SAAS,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,gBAAgB,EAAE,QAAQ,CAAC;IACzF,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,UAAU,YAAY,GAAG,CAAC;IAEhC,IAAI,CAAC,SAAS,OAAO;QACnB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,UAAU,OAAO,IAAI,CAAC,QAAQ,KAAK,EAAE,UAAU,QAAQ,CAAC;QAC9D,MAAM,CAAC,SAAS,GAAG,QAAQ,KAAK,CAAC;QAEjC,MAAM,QAAQ,MAAM,0HAAM,CAAC,KAAK,CAAC,UAAU,CAAC;YAC1C,OAAO;gBAAE;YAAS;QACpB;QAEA,OAAO,CAAC,CAAC;IACX,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,MAAM,QAAgB,EAAE,QAAgB;IAC5D,IAAI;QACF,MAAM,QAAQ,MAAM,0HAAM,CAAC,KAAK,CAAC,UAAU,CAAC;YAC1C,OAAO;gBAAE;YAAS;QACpB;QAEA,IAAI,CAAC,OAAO;YACV,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAsB;QACxD;QAEA,MAAM,UAAU,MAAM,eAAe,UAAU,MAAM,QAAQ;QAE7D,IAAI,CAAC,SAAS;YACZ,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAsB;QACxD;QAEA,MAAM,eAAe,MAAM,cAAc;QACzC,MAAM,cAAc,MAAM,IAAA,4IAAO;QAEjC,YAAY,GAAG,CAAC,qBAAqB,cAAc;YACjD,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK;YAClB,MAAM;QACR;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO;YAAE,SAAS;YAAO,OAAO;QAAiC;IACnE;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACrB;AAEO,eAAe;IACpB,MAAM,gBAAgB,QAAQ,GAAG,CAAC,cAAc,IAAI;IACpD,MAAM,gBAAgB,QAAQ,GAAG,CAAC,cAAc,IAAI;IAEpD,MAAM,gBAAgB,MAAM,0HAAM,CAAC,KAAK,CAAC,UAAU,CAAC;QAClD,OAAO;YAAE,UAAU;QAAc;IACnC;IAEA,IAAI,CAAC,eAAe;QAClB,MAAM,iBAAiB,MAAM,aAAa;QAC1C,MAAM,0HAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACxB,MAAM;gBACJ,UAAU;gBACV,UAAU;YACZ;QACF;QACA,QAAQ,GAAG,CAAC;IACd;AACF"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///E:/downloads/project/jewelry-showcase/app/api/products/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport prisma from '@/lib/prisma';\r\nimport { validateSession } from '@/lib/auth';\r\n\r\n// GET single product\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    \r\n    const product = await prisma.product.findUnique({\r\n      where: { id },\r\n      include: {\r\n        images: {\r\n          select: {\r\n            id: true,\r\n            mimeType: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!product) {\r\n      return NextResponse.json(\r\n        { error: 'Product not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(product);\r\n  } catch (error) {\r\n    console.error('Error fetching product:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch product' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// PUT update product\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const isAuthenticated = await validateSession();\r\n    if (!isAuthenticated) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const { id } = await params;\r\n    const formData = await request.formData();\r\n    \r\n    const name = formData.get('name') as string;\r\n    const category = formData.get('category') as string;\r\n    const description = formData.get('description') as string;\r\n    const price = parseFloat(formData.get('price') as string);\r\n    const material = formData.get('material') as string;\r\n    const inStock = formData.get('inStock') === 'true';\r\n    const featured = formData.get('featured') === 'true';\r\n    const images = formData.getAll('images') as File[];\r\n    const deleteImageIds = formData.getAll('deleteImages') as string[];\r\n\r\n    // Check if product exists\r\n    const existingProduct = await prisma.product.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!existingProduct) {\r\n      return NextResponse.json(\r\n        { error: 'Product not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Delete specified images\r\n    if (deleteImageIds.length > 0) {\r\n      await prisma.image.deleteMany({\r\n        where: {\r\n          id: { in: deleteImageIds },\r\n          productId: id,\r\n        },\r\n      });\r\n    }\r\n\r\n    // Update product\r\n    const product = await prisma.product.update({\r\n      where: { id },\r\n      data: {\r\n        name,\r\n        category,\r\n        description,\r\n        price,\r\n        material,\r\n        inStock,\r\n        featured,\r\n      },\r\n    });\r\n\r\n    // Add new images\r\n    for (const image of images) {\r\n      if (image && image.size > 0) {\r\n        const buffer = Buffer.from(await image.arrayBuffer());\r\n        await prisma.image.create({\r\n          data: {\r\n            data: buffer,\r\n            mimeType: image.type,\r\n            productId: product.id,\r\n          },\r\n        });\r\n      }\r\n    }\r\n\r\n    const productWithImages = await prisma.product.findUnique({\r\n      where: { id: product.id },\r\n      include: {\r\n        images: {\r\n          select: {\r\n            id: true,\r\n            mimeType: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(productWithImages);\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to update product' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// DELETE product\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const isAuthenticated = await validateSession();\r\n    if (!isAuthenticated) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const { id } = await params;\r\n\r\n    // Check if product exists\r\n    const existingProduct = await prisma.product.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!existingProduct) {\r\n      return NextResponse.json(\r\n        { error: 'Product not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Delete product (images will be cascade deleted)\r\n    await prisma.product.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to delete product' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}